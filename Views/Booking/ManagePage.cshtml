@model HomeworkAssignment1.Models.Manage

@{
    ViewBag.Title = "Manage Drivers and Vehicles";
}

<h2>Driver and Vehicle Management</h2>

<div class="row">
    <div class="col-md-6">
        <h3>Drivers</h3>
        <div class="input-group mb-3">
            <input type="text" id="driverSearch" class="form-control" placeholder="Search by name" value="@Model.searchDriverName">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchDriverBtn">Search</button>
            </div>
        </div>
        <table class="table" id="driversTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Service</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var driver in Model.Drivers)
                {
                    <tr>
                        <td>@driver.driverFirstName @driver.driverLastName</td>
                        <td>@driver.driverPhoneNumber</td>
                        <td>@driver.driverServiceType</td>
                        <td>
                            <button class="btn btn-sm btn-warning edit-driver" data-id="@driver.driverID">Edit</button>
                            <button class="btn btn-sm btn-danger delete-driver" data-id="@driver.driverID">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <button id="addDriverBtn" class="btn btn-success" data-toggle="modal" data-target="#addDriverModal">Add Driver</button>
    </div>

    <div class="col-md-6">
        <h3>Vehicles</h3>
        <div class="input-group mb-3">
            <input type="text" id="vehicleSearch" class="form-control" placeholder="Search by type" value="@Model.searchServiceType">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchVehicleBtn">Search</button>
            </div>
        </div>
        <table class="table" id="vehiclesTable">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Registration</th>
                    <th>Service</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var vehicle in Model.Vehicles)
                {
                    <tr>
                        <td>@vehicle.vehicleType</td>
                        <td>@vehicle.vehicleRegistration</td>
                        <td>@vehicle.vehicleServiceType</td>
                        <td>
                            <button class="btn btn-sm btn-warning edit-vehicle" data-id="@vehicle.vehicleID">Edit</button>
                            <button class="btn btn-sm btn-danger delete-vehicle" data-id="@vehicle.vehicleID">Delete</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <button id="addVehicleBtn" class="btn btn-success" data-toggle="modal" data-target="#addVehicleModal">Add Vehicle</button>
    </div>
</div>

<!-- Add Driver Modal -->
<div class="modal fade" id="addDriverModal" tabindex="-1" role="dialog" aria-labelledby="addDriverModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addDriverModalLabel">Add Driver</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addDriverForm">
                    <div class="form-group">
                        <label for="driverFirstName">First Name</label>
                        <input type="text" class="form-control" id="driverFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="driverLastName">Last Name</label>
                        <input type="text" class="form-control" id="driverLastName" required>
                    </div>
                    <div class="form-group">
                        <label for="driverPhoneNumber">Phone</label>
                        <input type="tel" class="form-control" id="driverPhoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="driverServiceType">Service Type</label>
                        <input type="text" class="form-control" id="driverServiceType" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveDriverBtn">Save Driver</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Vehicle Modal -->
<div class="modal fade" id="addVehicleModal" tabindex="-1" role="dialog" aria-labelledby="addVehicleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addVehicleModalLabel">Add Vehicle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addVehicleForm">
                    <div class="form-group">
                        <label for="vehicleType">Type</label>
                        <input type="text" class="form-control" id="vehicleType" required>
                    </div>
                    <div class="form-group">
                        <label for="vehicleRegistration">Registration</label>
                        <input type="text" class="form-control" id="vehicleRegistration" required>
                    </div>
                    <div class="form-group">
                        <label for="vehicleServiceType">Service Type</label>
                        <input type="text" class="form-control" id="vehicleServiceType" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveVehicleBtn">Save Vehicle</button>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function () {
            // Initialize data
            populateDriversTable();
            populateVehiclesTable();

            // Driver search
            $('#searchDriverBtn').click(function() {
                const searchTerm = $('#driverSearch').val();
                window.location.href = '@Url.Action("ManagePage", "Booking")?searchDriverName=' + searchTerm + '&searchServiceType=' + $('#vehicleSearch').val();
            });

            // Vehicle search
            $('#searchVehicleBtn').click(function() {
                const searchTerm = $('#vehicleSearch').val();
                window.location.href = '@Url.Action("ManagePage", "Booking")?searchDriverName=' + $('#driverSearch').val() + '&searchServiceType=' + searchTerm;
            });

            // Add driver button
            $('#addDriverBtn').click(function() {
                $('#addDriverForm')[0].reset(); // Reset the form
            });

            // Save driver button
            $('#saveDriverBtn').click(function() {
                const newDriver = {
                    driverFirstName: $('#driverFirstName').val(),
                    driverLastName: $('#driverLastName').val(),
                    driverPhoneNumber: $('#driverPhoneNumber').val(),
                    driverServiceType: $('#driverServiceType').val(),
                };

                $.post('@Url.Action("AddDriver", "Booking")', newDriver, function() {
                    location.reload(); // Reload the page to see the new driver
                });
            });

            // Save vehicle button
            $('#saveVehicleBtn').click(function() {
                const newVehicle = {
                    vehicleType: $('#vehicleType').val(),
                    vehicleRegistration: $('#vehicleRegistration').val(),
                    vehicleServiceType: $('#vehicleServiceType').val(),
                };

                $.post('@Url.Action("AddVehicle", "Booking")', newVehicle, function() {
                    location.reload(); // Reload the page to see the new vehicle
                });
            });

            // Delete driver
            $(document).on('click', '.delete-driver', function() {
                const driverId = $(this).data('id');
                if (confirm('Are you sure you want to delete this driver?')) {
                    $.post('@Url.Action("DeleteDriver", "Booking")', { id: driverId }, function() {
                        location.reload(); // Reload the page to see the updated list
                    });
                }
            });

            // Delete vehicle
            $(document).on('click', '.delete-vehicle', function() {
                const vehicleId = $(this).data('id');
                if (confirm('Are you sure you want to delete this vehicle?')) {
                    $.post('@Url.Action("DeleteVehicle", "Booking")', { id: vehicleId }, function() {
                        location.reload(); // Reload the page to see the updated list
                    });
                }
            });
        });

        function populateDriversTable() {
            // This function can be used to populate the drivers table if needed
        }

        function populateVehiclesTable() {
            // This function can be used to populate the vehicles table if needed
        }
    </script>
}
